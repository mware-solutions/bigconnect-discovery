<!--
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~      http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org" th:with="lang=${#locale.language}" th:lang="${lang}">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title th:text="${clientName}"></title>

    <!-- disable IE compatible view -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
      * {
        margin: 0;
        padding: 0;
        font-family: sans-serif;
        box-sizing: content-box;
        line-height: 1.3em;
      }

      *:focus {
        outline: none;
      }

      html, body {
        width: 100%;
        height: 100%;
        min-width: 1200px;
        line-height: 1.3em;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        -ms-text-size-adjust: 100%;
        -webkit-text-size-adjust: 100%;
        -webkit-user-select: text;
        -moz-user-select: text;
        -ms-user-select: text;
        user-select: text;
        background-color: #fff;
      }

      body, p, h1, h2, h3, h4, h5, h6, ul, ol, li, dl, dt, dd, table, th, td, form, fieldset, legend, input, textarea, button, select {
        margin: 0;
        padding: 0;
        font-size: 12px;
        color: #4b515b;
      }

      a, u, a:hover {
        text-decoration: none;
        color: #707070;
      }

      a {
        outline: 0;
      }

      ul, ol {
        list-style: none;
      }

      input::-ms-clear {
        display: none;
      }

      input::placeholder {
        color: #b7b9c2;
        font-family: sans-serif;
        line-height: 1.3em;
      }

      input::-webkit-input-placeholder {
        color: #b7b9c2;
        font-family: sans-serif;
        line-height: 1.3em;
      }

      input:-ms-input-placeholder {
        color: #b7b9c2;
        font-family: sans-serif;
        line-height: 1.3em;
      }

      .ddp-wrap-login {
        height: 100%;
        min-height: 800px;
        background: url(/assets/images/login.jpg) no-repeat center center fixed;
        background-size: cover;
      }

      .ddp-wrap-login .ddp-blur2 {
        display: block;
        background: url(/assets/images/login.jpg) no-repeat fixed;;
        background-size: cover;
        overflow: hidden;
        content: '';
        filter: blur(5px);
        position: absolute;
        left: 0;
        bottom: 0;
        height: 100%;
        width: 410px;
      }

      .ddp-ui-header {
        font-size: 14px;
        color: #272950;
        position:absolute;
        top:10px;
        left:50%;
        margin-left:-190px;
        z-index: 10;
      }

      .ddp-ui-header img {
        position:relative;
        top:1px;
        width: 13px;
        height: 13px;
      }

      .ddp-ui-login {
        position: relative;
        width: 410px;
        height: 100%;
        padding: 192px 0 0 0;
        background-color: rgba(255, 255, 255, 0.7);
        z-index: 1;
        box-sizing: border-box;
      }

      .ddp-ui-login .ddp-box-login {
        width: 278px;
        margin: 0 auto;
      }

      .ddp-ui-login .ddp-ui-logo {
        padding-bottom: 20px;
      }

      .ddp-ui-login .ddp-ui-logo .ddp-ui-desc{
        text-align: center;
        position: relative;
        top: 5px;
        font-size: 15px;
      }

      .ddp-ui-login .ddp-ui-logo .ddp-ui-desc span{
        font-weight: bold;
        color: #272950;
      }

      .ddp-form-login .ddp-form-input {
        position: relative;
        width: 100%;
        box-sizing: border-box;
      }

      .ddp-form-login .ddp-form-input label {
        display: block;
        padding: 30px 0 0 0;
        color: rgba(39, 41, 80, 0.7);
        font-size: 13px;
      }

      .ddp-form-login .ddp-form-input span.ddp-input-type {
        display: block;
        width: 100%;
        border: none;
        background: transparent;
      }

      .ddp-form-login .ddp-form-input span.ddp-input-type input {
        width: 100%;
        padding: 8px 0;
        border: none;
        border-bottom: 1px solid #b5b5cc;
        background-color: transparent;
        color: #272950;
        font-size: 18px;
      }

      .ddp-form-login .ddp-form-input span.ddp-input-type input:-webkit-autofill {
        -webkit-box-shadow: 0 0 0 1000px white inset;
      }

      .ddp-form-login .ddp-form-input span.ddp-input-type input:focus {
        border-bottom: 1px solid #272950;
      }

      .ddp-form-login .ddp-ui-login-option .ddp-wrap-input-checkbox label {
        position: relative;
        font-size: 14px;
        color: #272950;
      }

      .ddp-form-login .ddp-ui-login-option .ddp-wrap-input-checkbox input[type="checkbox"] {
        position: absolute;
        top: 50%;
        left: 0;
        margin-top: -6px;
        z-index: 1;
      }

      .ddp-form-login .ddp-ui-login-option .ddp-wrap-input-checkbox input[type="checkbox"]:checked + label {
        font-weight: bold;
      }

      .ddp-ui-input-form {
        position: relative;
        padding-bottom: 35px;
      }

      .ddp-ui-input-form .ddp-ui-error {
        display: block;
        position: absolute;
        bottom: 15px;
        color: #eb5f58;
        font-size: 12px;
      }

      .ddp-ui-input-form .ddp-ui-error em.ddp-icon-error {
        display: none;
        position: relative;
        top: -1px;
        margin-right: 5px;
        width: 11px;
        height: 11px;
        background: url(/assets/images/icon_info.png) no-repeat;
        background-position: -16px 0;
        vertical-align: middle;
      }

      .ddp-ui-input-form .ddp-input-check {
        position: relative;
        padding-right: 20px;
        border-bottom: 1px solid #ddd;
      }

      .ddp-ui-input-form .ddp-input-check input {
        border-bottom: none;
      }

      .ddp-ui-input-form .ddp-input-check em.ddp-icon-error {
        display: inline-block;
        position: absolute;
        top: 50%;
        right: 0;
        background: url(/assets/images/icon_message.png) no-repeat;
      }

      .ddp-ui-input-form .ddp-input-check em.ddp-icon-error {
        display: none;
        width: 9px;
        height: 9px;
        margin-top: -5px;
      }

      .ddp-ui-input-form.ddp-type-error .ddp-input-check .ddp-icon-error {
        display: block;
      }

      .ddp-ui-login-buttons {
        padding-bottom: 15px;
        margin-top: 55px;
      }

      .ddp-ui-login-buttons a.ddp-btn {
        display: inline-block;
        width: 100%;
        color: #fff;
        font-size: 14px;
        text-align: center;
        line-height: 38px;
        font-weight: bold;
        border-radius: 3px;
        background-color: #272950;
      }

      .ddp-ui-login-buttons a.ddp-btn:hover {
        background-color: #7575ea;
      }

      .ddp-layout-footer {
        position: absolute;
        left: 66px;
        bottom: 80px;
        width: 278px;
        text-align: center;
        z-index: 1;
        overflow: hidden;
      }

      .ddp-ui-footer {
        display: inline-block;
        position: relative;
        text-align: left;
      }

      .ddp-ui-footer ul.ddp-list-footer li {
        float: left;
      }

      .ddp-ui-footer ul.ddp-list-footer li a {
        display: block;
        position: relative;
        padding: 0 7px 0 6px;
        color: #272950;
        font-weight: 300;
      }

      .ddp-ui-footer ul.ddp-list-footer li a:hover {
        text-decoration: underline;
      }

      .ddp-ui-footer ul.ddp-list-footer li a em {
        display: none;
      }

      .ddp-ui-footer ul.ddp-list-footer li:first-of-type a:after {
        display: none;
      }

      .ddp-ui-footer ul.ddp-list-footer li a:after {
        display: inline-block;
        position: absolute;
        top: 50%;
        left: 0;
        margin-top: -7px;
        content: '';
        height: 13px;
        border-right: 1px solid #909090;
      }

      .ddp-ui-footer ul.ddp-list-footer li:first-child a {
        padding-left: 0;
      }

      .ddp-ui-footer span.ddp-ui-copy {
        float: left;
        display: inline-block;
        padding: 3px 0 0 0;
        color: rgba(39, 41, 80, 0.6);
        font-size: 12px;
        letter-spacing: -1px;
      }
    </style>
  </head>
  <!-- login -->
  <body>
    <div class="ddp-wrap-login">
      <em class="ddp-bg-login"></em>
      <em class="ddp-blur2" style="position:absolute; left:50%; margin-left:-205px;"></em>
      <!-- login -->
      <div class="ddp-ui-header">
        <img src="/assets/images/oauth/metatron.png">
        <span th:text="#{message.app.oauth.login.header}"></span>
      </div>
      <div class="ddp-ui-login" style="position:absolute; top:0; left:50%; margin-left:-205px;">
        <div class="ddp-box-login">
          <div class="ddp-ui-logo">
            <img th:src="${'/assets/images/oauth/' + #strings.replace(#strings.toLowerCase(clientName), ' ', '_') + '.svg'}" onerror="this.onerror=null;this.src='/assets/images/oauth/logo.svg'">
            <div class="ddp-ui-desc" th:utext="#{message.app.oauth.home(${clientName})}"></div>
          </div>

          <!-- login form -->
          <div class="ddp-form-login">
            <!-- ID 입력 -->
            <div class="ddp-form-input ddp-ui-input-form" style="padding-bottom:0px;">
              <label class="ddp-label-type"
                     th:text="#{message.app.oauth.login.name.title}"></label>
              <div class="ddp-input-check">
                <span class="ddp-input-type">
                  <input type="text" name="username"
                         th:placeholder="#{message.app.oauth.login.name.title.ph}"
                         style="border-bottom:none;"/>
                </span>
                <em class="ddp-icon-error" name="usernameErrorIcon"></em>
              </div>
            </div>
            <!-- // ID 입력 -->

            <!-- Password 입력 -->
            <div class="ddp-form-input ddp-ui-input-form" style="padding-bottom:0px;">
              <label class="ddp-label-type"
                     th:text="#{message.app.oauth.login.pw.title}"></label>
              <div class="ddp-input-check">
                <span class="ddp-input-type">
                  <input type="password" th:placeholder="#{message.app.oauth.login.pw.title.ph}"
                         name="password" style="border-bottom:none;"/>
                </span>
                <em class="ddp-icon-error" name="passwordErrorIcon"></em>
              </div>
              <!-- error 메시지 -->
              <span class="ddp-ui-error" style="bottom:-45px;" name="loginFailMsg"></span>
              <!-- //error 메시지 -->
            </div>
            <!-- // Password 입력 -->

            <!-- button -->
            <div class="ddp-ui-login-buttons">
              <a href="javascript:" class="ddp-btn" name="loginBtn"
                 th:text="#{message.app.oauth.login}"></a>
            </div>
            <!-- //button -->

          </div>
          <!-- //login form -->
        </div>

        <!-- footer -->
        <div class="ddp-layout-footer">
          <div class="ddp-ui-footer">
            <span class="ddp-ui-copy">Copyright © SK Telecom Co., Ltd. All rights reserved.</span>
          </div>
        </div>
        <!-- // footer -->

      </div>
      <!-- //login -->

    </div>
    <script src="/assets/js/jquery.min.js"></script>
    <script type="text/javascript" th:inline="javascript">
      /* <![CDATA[ */
      var oauthLogin = {
        basicHeader: /*[[${basicHeader}]]*/,
        bind: function () {
          $("a[name=loginBtn]").bind('click', function () {
              oauthLogin.login();
          });

          $("input[name=username], input[name=password]").bind('focus', function () {
              oauthLogin.init();
          });

          $("input[name=password]").bind('keyup', function (e) {
              if (e.keyCode == '13') {
                  oauthLogin.login();
              }
          });

          $("em[name=usernameErrorIcon]").bind('click', function () {
              $("input[name=username]").val('');
              oauthLogin.init();
          });

          $("em[name=passwordErrorIcon]").bind('click', function () {
              $("input[name=password]").val('');
              oauthLogin.init();
          });
          $("input[name=username]").focus();
        },
        login: function () {
          var method = 'POST';
          var header = {Authorization: oauthLogin.basicHeader};
          var url = '/oauth/token';
          var param = {
              username: $("input[name=username]").val(),
              password: $("input[name=password]").val(),
              grant_type: 'password',
              scope: 'write'
          };
          var success = function (result) {
              document.cookie = 'LOGIN_TOKEN=' + result.access_token + ';path=/';
              document.cookie = 'LOGIN_TOKEN_TYPE=' + result.token_type + ';path=/';
              document.cookie = 'REFRESH_LOGIN_TOKEN=' + result.refresh_token + ';path=/';
              document.cookie = 'LOGIN_USER_ID=' + $("input[name=username]").val() + ';path=/';
              oauthLogin.permission(result.token_type + ' ' + result.access_token);
          };
          var error = function (err) {
              oauthLogin.loginFail(err.responseJSON.details);
          };
          oauthLogin.ajax(method, header, url, param, success, error);
        },
        permission: function (authHeader) {
          var method = 'GET';
          var header = {Authorization: authHeader};
          var url = '/api/auth/SYSTEM/permissions';
          var success = function (result) {
              document.cookie = 'PERMISSION=' + result.join('==') + ';path=/';
              location.replace(document.location.href);
          };
          var error = function () {
              location.replace(document.location.href);
          };
          oauthLogin.ajax(method, header, url, null, success, error);
        },
        init: function () {
          $('.ddp-ui-input-form').removeClass('ddp-type-error');
          $('span[name=loginFailMsg]').text('');
        },
        loginFail: function (msg) {
          $('.ddp-ui-input-form').addClass('ddp-type-error');
          $('span[name=loginFailMsg]').text(msg);
        },
        ajax: function (method, header, url, param, success, error) {
          $.ajax({type: method,
                     url: url,
                     data: param,
                     headers: header,
                     success: success,
                     error: error
                 })
        }
      };

      /* ]]> */
      $(document).ready(function () {
        oauthLogin.bind();
      });
    </script>
  </body>
</html>